<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF â†’ Quiz (Local) | Dev : Ahmad Shami</title>

  <!-- âœ… Local PDF.js (NO CDN) -->
  <script src="./vendor/pdfjs/pdf.min.js"></script>

  <style>
    :root{
      --bg:#0b1020; --card:rgba(255,255,255,.06); --txt:#eaf0ff; --muted:rgba(234,240,255,.7);
      --good:#28d17c; --bad:#ff4d6d; --bd:rgba(255,255,255,.12);
      --btn:#2d6cdf; --btn2:#1b2446;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: radial-gradient(1200px 800px at 20% 10%, #1a2a6c33, transparent),
                  radial-gradient(900px 700px at 80% 20%, #b21f1f26, transparent),
                  radial-gradient(900px 700px at 50% 90%, #fdbb2d14, transparent),
                  var(--bg);
      color:var(--txt); padding:18px;
    }
    .wrap{max-width:1020px;margin:0 auto}
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    h1{font-size:18px;margin:0}
    .pill{padding:7px 10px;border:1px solid var(--bd);border-radius:999px;background:rgba(0,0,0,.15);color:var(--muted);font-size:12px}
    .card{
      margin-top:14px;border:1px solid var(--bd);
      background:linear-gradient(180deg,var(--card),rgba(0,0,0,.15));
      border-radius:16px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:end}
    .row > *{flex:1}
    .btn{
      border:1px solid var(--bd);
      background:linear-gradient(180deg,rgba(45,108,223,.95),rgba(30,78,170,.85));
      color:white;padding:12px 14px;border-radius:14px;font-weight:800;cursor:pointer;min-width:180px;
    }
    .btn.secondary{background:linear-gradient(180deg,rgba(27,36,70,.95),rgba(20,26,50,.9))}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    input[type="file"], input[type="number"], select{
      width:100%;padding:12px 14px;border-radius:14px;border:1px solid var(--bd);
      background:rgba(0,0,0,.18);color:var(--txt);outline:none;
    }
    input[type="file"]{border-style:dashed;color:var(--muted)}
    .status{margin-top:10px;padding:10px 12px;border-radius:12px;border:1px solid var(--bd);
      background:rgba(0,0,0,.18);color:var(--muted);font-size:13px;line-height:1.6;white-space:pre-wrap}
    .status.good{border-color:rgba(40,209,124,.5); color:#bff8dc}
    .status.bad{border-color:rgba(255,77,109,.5); color:#ffd1db}
    textarea{
      width:100%;min-height:170px;resize:vertical;padding:12px 14px;border-radius:14px;border:1px solid var(--bd);
      background:rgba(0,0,0,.18);color:var(--txt);outline:none;line-height:1.7;font-size:14px;
    }
    .small{color:var(--muted);font-size:12px;margin-top:8px;line-height:1.7}
    .grid{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:860px){ .grid{grid-template-columns:1fr 1fr} }
    .q{
      border:1px solid var(--bd); background:rgba(0,0,0,.18); border-radius:14px; padding:12px;
    }
    .q h3{margin:0 0 10px 0;font-size:14px}
    .opt{display:flex;gap:10px;align-items:center;margin:6px 0}
    .opt input{width:auto}
    .resultBox{margin-top:10px;padding:12px;border-radius:14px;border:1px solid var(--bd);background:rgba(0,0,0,.18)}
    .ok{color:#bff8dc}
    .no{color:#ffd1db}
    .footer{margin-top:14px;color:var(--muted);text-align:center;font-size:12px}
  </style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <h1>PDF â†’ Quiz PRO (ØªØ¬Ø±Ø¨Ø© Ù…Ø­Ù„ÙŠØ©)</h1>
    <div class="pill" id="libPill">Ø¬Ø§Ø±Ù Ø§Ù„ÙØ­Øµâ€¦</div>
  </div>

  <div class="card">
    <div class="row">
      <div>
        <div class="small">1) Ø§Ø®ØªØ± Ù…Ù„Ù PDF (Ù†ØµÙ‘ÙŠ ÙˆÙ„ÙŠØ³ Scan Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ù†ØªØ§Ø¦Ø¬)</div>
        <input id="pdfFile" type="file" accept="application/pdf" />
        <div class="small">Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯: <b>vendor/pdfjs/pdf.min.js</b> Ùˆ <b>vendor/pdfjs/pdf.worker.min.js</b></div>
      </div>

      <div style="min-width:240px">
        <button class="btn" id="extractBtn" disabled>ğŸ“„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ (PDF)</button>
        <button class="btn secondary" id="clearBtn">ğŸ§¹ Ù…Ø³Ø­</button>
      </div>
    </div>

    <div class="status" id="status">Ø§Ø®ØªØ± Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹.</div>

    <div style="margin-top:12px">
      <div class="small">Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬</div>
      <textarea id="out" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù†Øµ Ù‡Ù†Ø§â€¦"></textarea>
      <div class="small">Ø¥Ø°Ø§ ÙƒØ§Ù† PDF Scan (ØµÙˆØ±) Ù„Ø§Ø²Ù… OCR (Ù†Ø¶ÙŠÙÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ø­Ù„ÙŠ Ø£Ùˆ Ø¨Ø³ÙŠØ±ÙØ±).</div>
    </div>
  </div>

  <div class="card">
    <div class="grid">
      <div>
        <div class="small">2) Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
        <div class="row">
          <div>
            <label class="small">ØµØ­/Ø®Ø·Ø£</label>
            <input id="nTF" type="number" min="0" max="30" value="5">
          </div>
          <div>
            <label class="small">Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯</label>
            <input id="nMCQ" type="number" min="0" max="30" value="5">
          </div>
          <div>
            <label class="small">Ø£Ø³Ø¦Ù„Ø© Ø´Ø±Ø­</label>
            <input id="nSA" type="number" min="0" max="20" value="3">
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <button class="btn" id="genBtn">âœ¨ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
          <button class="btn secondary" id="gradeBtn" disabled>âœ… ØªØµØ­ÙŠØ­ + Ø¹Ù„Ø§Ù…Ø© /100</button>
        </div>

        <div class="small">
          * Ù‡Ø°Ø§ Ù…ÙˆÙ„Ù‘Ø¯ Ù…Ø­Ù„ÙŠ (Ø¨Ø¯ÙˆÙ† AI) ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ: ÙŠÙ‚Ø³Ù…Ù‡ Ù„Ø¬Ù…Ù„ ÙˆÙŠØ®ØªØ§Ø± ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© ÙˆÙŠØ¹Ù…Ù„ Ø£Ø³Ø¦Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.<br>
          * Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªØªØ­Ø³Ù† Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„Ù†Øµ Ù…Ø±ØªØ¨ ÙˆÙˆØ§Ø¶Ø­.
        </div>
      </div>

      <div>
        <div class="small">Ø§Ù„Ù†ØªÙŠØ¬Ø©</div>
        <div class="resultBox" id="scoreBox">â€”</div>
        <div class="footer">Dev : Ahmad Shami</div>
      </div>
    </div>
  </div>

  <div class="card" id="quizCard" style="display:none">
    <div class="small">3) Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
    <div id="quiz"></div>
  </div>
</div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const pdfFile = $("pdfFile");
  const extractBtn = $("extractBtn");
  const clearBtn = $("clearBtn");
  const statusEl = $("status");
  const outEl = $("out");
  const libPill = $("libPill");

  const nTF = $("nTF");
  const nMCQ = $("nMCQ");
  const nSA = $("nSA");
  const genBtn = $("genBtn");
  const gradeBtn = $("gradeBtn");
  const quizCard = $("quizCard");
  const quizEl = $("quiz");
  const scoreBox = $("scoreBox");

  let PDF_DOC = null;
  let quizModel = []; // {type, q, options?, answer, user?}

  function setStatus(msg, ok=null){
    statusEl.textContent = msg;
    statusEl.classList.remove("good","bad");
    if(ok === true) statusEl.classList.add("good");
    if(ok === false) statusEl.classList.add("bad");
  }
  function setLibPill(text, ok){
    libPill.textContent = text;
    libPill.style.borderColor = ok ? "rgba(40,209,124,.6)" : "rgba(255,77,109,.6)";
    libPill.style.color = ok ? "#bff8dc" : "#ffd1db";
  }

  // ---- PDF.js local check
  if(typeof window.pdfjsLib === "undefined"){
    setLibPill("PDF.js ØºÙŠØ± Ù…Ø­Ù…Ù‘Ù„ âŒ", false);
    setStatus("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ PDF.js Ù…Ø­Ù„ÙŠØ§Ù‹. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯:\nvendor/pdfjs/pdf.min.js\nvendor/pdfjs/pdf.worker.min.js", false);
    return;
  }
  setLibPill("PDF.js Ù…Ø­Ù„ÙŠ Ø¬Ø§Ù‡Ø² âœ…", true);

  pdfjsLib.GlobalWorkerOptions.workerSrc = "./vendor/pdfjs/pdf.worker.min.js";

  async function loadPDF(file){
    const ab = await file.arrayBuffer();
    const task = pdfjsLib.getDocument({ data: ab });
    PDF_DOC = await task.promise;
    return PDF_DOC;
  }

  async function extractTextFromPDF(){
    if(!PDF_DOC) throw new Error("No PDF loaded");
    const total = PDF_DOC.numPages;
    let all = "";
    for(let p=1; p<=total; p++){
      setStatus(`Ø¬Ø§Ø±Ù Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµâ€¦ ØµÙØ­Ø© ${p}/${total}`, true);
      const page = await PDF_DOC.getPage(p);
      const content = await page.getTextContent();
      const strings = content.items.map(it => it.str).filter(Boolean);
      all += strings.join(" ") + "\n\n";
    }
    return all.trim();
  }

  // ---- Local quiz generator (no AI)
  function normalizeText(t){
    return (t||"")
      .replace(/\s+/g," ")
      .replace(/[â€œâ€]/g,'"')
      .replace(/[â€™]/g,"'")
      .trim();
  }

  function splitSentences(t){
    // works for Arabic/English mixed
    const raw = t
      .replace(/\n+/g," ")
      .replace(/\s+/g," ")
      .trim();
    const parts = raw.split(/(?<=[\.\!\?ØŸØ›:])\s+/);
    return parts.map(s=>s.trim()).filter(s=>s.length>=35); // avoid tiny fragments
  }

  function pickKeywords(sentence){
    // pick "interesting" tokens: long words, latin terms, uppercase-ish, or words with hyphen
    const toks = sentence
      .replace(/[(){}\[\]ØŒ,]/g," ")
      .split(/\s+/)
      .map(w=>w.trim())
      .filter(w=>w.length>=4);

    const candidates = [];
    for(const w of toks){
      const isLatin = /[A-Za-z]/.test(w);
      const isLong = w.length>=7;
      const hasDash = /-/.test(w);
      if(isLatin || isLong || hasDash) candidates.push(w.replace(/[^\w\u0600-\u06FF-]/g,""));
    }
    // unique
    return [...new Set(candidates)].slice(0, 8);
  }

  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  function makeTF(sentences, n){
    const chosen = shuffle(sentences).slice(0, n);
    return chosen.map((s, idx)=>{
      // 50% make false by removing/altering a keyword
      const kws = pickKeywords(s);
      let q = s;
      let ans = "ØµØ­";
      if(kws.length>=1 && Math.random()<0.5){
        ans = "Ø®Ø·Ø£";
        const k = kws[Math.floor(Math.random()*kws.length)];
        // replace keyword with something wrong-ish
        q = s.replace(k, k.split("").reverse().join("")); // simple wrong token
      }
      return { type:"TF", q:`(${idx+1}) ${q}`, options:["ØµØ­","Ø®Ø·Ø£"], answer:ans };
    });
  }

  function makeMCQ(sentences, n){
    const poolK = sentences.flatMap(s=>pickKeywords(s));
    const uniqPool = [...new Set(poolK)].filter(x=>x && x.length>=4);
    const chosenS = shuffle(sentences).slice(0, n);

    const items = [];
    for(let i=0;i<chosenS.length;i++){
      const s = chosenS[i];
      const kws = pickKeywords(s);
      if(kws.length===0) continue;

      const answer = kws[0];
      let stem = s;
      // blank the answer
      stem = stem.replace(answer, "_____");
      // build distractors from pool
      const distractors = shuffle(uniqPool.filter(k=>k!==answer)).slice(0, 3);
      const options = shuffle([answer, ...distractors]);
      items.push({ type:"MCQ", q:`(${items.length+1}) Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©: ${stem}`, options, answer });
      if(items.length>=n) break;
    }
    return items;
  }

  function makeSA(sentences, n){
    const chosen = shuffle(sentences).slice(0, n);
    return chosen.map((s, idx)=>{
      const kws = pickKeywords(s).slice(0, 3);
      const hint = kws.length ? ` (ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ©: ${kws.join("ØŒ ")})` : "";
      return {
        type:"SA",
        q:`(${idx+1}) Ø§Ø´Ø±Ø­ Ø¨Ø§Ø®ØªØµØ§Ø± Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù†Øµ:${hint}\n${s}`,
        // expected answer: keywords (we grade by keyword match)
        answer: kws
      };
    });
  }

  function buildQuizUI(model){
    quizEl.innerHTML = "";
    quizCard.style.display = "block";
    scoreBox.textContent = "â€”";
    gradeBtn.disabled = false;

    const sections = [
      {key:"TF", title:"ØµØ­ / Ø®Ø·Ø£"},
      {key:"MCQ", title:"Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯"},
      {key:"SA", title:"Ø£Ø³Ø¦Ù„Ø© Ø´Ø±Ø­"},
    ];

    for(const sec of sections){
      const secItems = model.filter(x=>x.type===sec.key);
      if(!secItems.length) continue;

      const header = document.createElement("div");
      header.className = "small";
      header.style.margin = "10px 0";
      header.innerHTML = `<b>${sec.title}</b>`;
      quizEl.appendChild(header);

      secItems.forEach((item, idx)=>{
        const box = document.createElement("div");
        box.className = "q";

        const h = document.createElement("h3");
        h.textContent = item.q;
        box.appendChild(h);

        if(item.type === "TF" || item.type === "MCQ"){
          const name = `q_${sec.key}_${idx}`;
          item.options.forEach(opt=>{
            const line = document.createElement("label");
            line.className = "opt";
            line.innerHTML = `<input type="radio" name="${name}" value="${opt}"><span>${opt}</span>`;
            box.appendChild(line);
          });
        } else if(item.type === "SA"){
          const ta = document.createElement("textarea");
          ta.placeholder = "Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§â€¦";
          ta.style.minHeight = "120px";
          ta.dataset.sa = "1";
          box.appendChild(ta);
          const sm = document.createElement("div");
          sm.className = "small";
          sm.textContent = "Ø§Ù„ØªØµØ­ÙŠØ­ Ù‡Ù†Ø§ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Ù…Ø­Ù„ÙŠ).";
          box.appendChild(sm);
        }

        quizEl.appendChild(box);
      });
    }
  }

  function gradeQuiz(){
    // scoring weights
    const tfItems = quizModel.filter(x=>x.type==="TF");
    const mcqItems = quizModel.filter(x=>x.type==="MCQ");
    const saItems = quizModel.filter(x=>x.type==="SA");

    const totalQuestions = tfItems.length + mcqItems.length + saItems.length;
    if(totalQuestions === 0){
      scoreBox.textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„Ù„ØªØµØ­ÙŠØ­.";
      return;
    }

    // weights: TF 30%, MCQ 40%, SA 30% distributed
    const wTF = tfItems.length ? 30/tfItems.length : 0;
    const wMCQ = mcqItems.length ? 40/mcqItems.length : 0;
    const wSA = saItems.length ? 30/saItems.length : 0;

    let score = 0;
    let report = [];

    // collect user answers from DOM by order
    const qBoxes = [...quizEl.querySelectorAll(".q")];
    let tfIndex=0, mcqIndex=0, saIndex=0;

    for(const box of qBoxes){
      // find which model item it corresponds to by scanning text prefix
      const text = box.querySelector("h3")?.textContent || "";

      if(text.includes("ØµØ­") && (box.querySelector('input[type="radio"]')) && tfIndex < tfItems.length){
        const name = box.querySelector('input[type="radio"]')?.name;
        const chosen = quizEl.querySelector(`input[name="${name}"]:checked`)?.value || "";
        const correct = tfItems[tfIndex].answer;
        const ok = chosen === correct;
        if(ok) score += wTF;
        report.push(`${ok?"âœ…":"âŒ"} ØµØ­/Ø®Ø·Ø£: Ø¬ÙˆØ§Ø¨Ùƒ (${chosen||"â€”"}) | Ø§Ù„ØµØ­ÙŠØ­ (${correct})`);
        tfIndex++;
        continue;
      }

      if(text.includes("Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©") && (box.querySelector('input[type="radio"]')) && mcqIndex < mcqItems.length){
        const name = box.querySelector('input[type="radio"]')?.name;
        const chosen = quizEl.querySelector(`input[name="${name}"]:checked`)?.value || "";
        const correct = mcqItems[mcqIndex].answer;
        const ok = chosen === correct;
        if(ok) score += wMCQ;
        report.push(`${ok?"âœ…":"âŒ"} Ø§Ø®ØªÙŠØ§Ø±: Ø¬ÙˆØ§Ø¨Ùƒ (${chosen||"â€”"}) | Ø§Ù„ØµØ­ÙŠØ­ (${correct})`);
        mcqIndex++;
        continue;
      }

      if(box.querySelector("textarea") && saIndex < saItems.length){
        const user = normalizeText(box.querySelector("textarea").value);
        const keys = saItems[saIndex].answer || [];
        let hit = 0;
        for(const k of keys){
          if(k && user.toLowerCase().includes(k.toLowerCase())) hit++;
        }
        const ratio = keys.length ? (hit/keys.length) : 0;
        const got = wSA * ratio;
        score += got;
        report.push(`${ratio>=0.67?"âœ…":"âŒ"} Ø´Ø±Ø­: ØªØ·Ø§Ø¨Ù‚ ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© ${hit}/${keys.length} (+${got.toFixed(1)})`);
        saIndex++;
        continue;
      }
    }

    score = Math.max(0, Math.min(100, Math.round(score)));
    scoreBox.innerHTML = `<div style="font-size:18px;font-weight:900;margin-bottom:8px">Ø¹Ù„Ø§Ù…ØªÙƒ: ${score} / 100</div>
                          <div class="small">${report.join("<br>")}</div>`;
  }

  // Events
  pdfFile.addEventListener("change", async () => {
    const f = pdfFile.files && pdfFile.files[0];
    PDF_DOC = null;
    extractBtn.disabled = true;
    outEl.value = "";
    setStatus("Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ø¶ÙŠØ±â€¦", true);

    if(!f){
      setStatus("Ø§Ø®ØªØ± Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹.", null);
      return;
    }
    try{
      await loadPDF(f);
      extractBtn.disabled = false;
      setStatus(`ØªÙ… ØªØ­Ù…ÙŠÙ„ PDF âœ… Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª: ${PDF_DOC.numPages}. Ø§Ø¶ØºØ· â€œØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµâ€.`, true);
    }catch(e){
      console.error(e);
      setStatus("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ PDF. Ø¬Ø±Ù‘Ø¨ Ù…Ù„Ù Ø£ØµØºØ± Ø£Ùˆ PDF ØºÙŠØ± Ù…Ø­Ù…ÙŠ Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±.", false);
    }
  });

  extractBtn.addEventListener("click", async () => {
    if(!PDF_DOC){ setStatus("Ø§Ø®ØªÙØ± Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹.", false); return; }
    extractBtn.disabled = true;
    try{
      const text = await extractTextFromPDF();
      outEl.value = text || "";
      if(!text) setStatus("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Øµ. Ù‡Ø°Ø§ ØºØ§Ù„Ø¨Ø§Ù‹ PDF Scan ÙˆÙŠØ­ØªØ§Ø¬ OCR.", false);
      else setStatus("ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ âœ…", true);
    }catch(e){
      console.error(e);
      setStatus("ØµØ§Ø± Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ.", false);
    }finally{
      extractBtn.disabled = false;
    }
  });

  genBtn.addEventListener("click", () => {
    const text = normalizeText(outEl.value);
    if(text.length < 120){
      setStatus("Ø§Ù„Ù†Øµ Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ø³ØªØ®Ø±Ø¬ Ù†Øµ PDF Ø£ÙˆÙ„Ø§Ù‹ (Ø£Ùˆ Ø§Ù„ØµÙ‚ Ù†Øµ Ø£Ø·ÙˆÙ„).", false);
      return;
    }
    const sents = splitSentences(text);
    if(sents.length < 3){
      setStatus("Ù…Ø§ Ù‚Ø¯Ø±Øª Ù‚Ø³Ù… Ø§Ù„Ù†Øµ Ù„Ø¬Ù…Ù„ ÙƒØ§ÙÙŠØ©. Ø¬Ø±Ù‘Ø¨ Ù†Øµ Ø£ÙˆØ¶Ø­/Ø£Ø·ÙˆÙ„.", false);
      return;
    }

    const tf = makeTF(sents, Number(nTF.value||0));
    const mcq = makeMCQ(sents, Number(nMCQ.value||0));
    const sa = makeSA(sents, Number(nSA.value||0));

    quizModel = [...tf, ...mcq, ...sa];
    buildQuizUI(quizModel);
    setStatus(`ØªÙ… ØªÙˆÙ„ÙŠØ¯ ${tf.length} ØµØ­/Ø®Ø·Ø£ØŒ ${mcq.length} Ø§Ø®ØªÙŠØ§Ø±ØŒ ${sa.length} Ø´Ø±Ø­ âœ…`, true);
  });

  gradeBtn.addEventListener("click", () => {
    gradeQuiz();
  });

  clearBtn.addEventListener("click", () => {
    outEl.value = "";
    pdfFile.value = "";
    PDF_DOC = null;
    extractBtn.disabled = true;
    quizModel = [];
    quizEl.innerHTML = "";
    quizCard.style.display = "none";
    gradeBtn.disabled = true;
    scoreBox.textContent = "â€”";
    setStatus("ØªÙ… Ø§Ù„Ù…Ø³Ø­. Ø§Ø®ØªØ± PDF Ø¬Ø¯ÙŠØ¯.", null);
  });

  // init
  gradeBtn.disabled = true;
})();
</script>
</body>
</html>
