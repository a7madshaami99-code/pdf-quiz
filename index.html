<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart PDF Quiz | Dev : Ahmad Shami</title>

<!-- PDF.js Ù…Ø­Ù„ÙŠ -->
<script src="./vendor/pdfjs/pdf.min.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:white;
  padding:20px;
}
button{
  padding:10px 15px;
  margin:5px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}
.primary{background:#2563eb;color:white;}
.secondary{background:#475569;color:white;}
.success{background:#16a34a;color:white;}
textarea{
  width:100%;
  min-height:150px;
  margin-top:10px;
  border-radius:8px;
  padding:10px;
}
.quiz-box{
  margin-top:20px;
  background:#1e293b;
  padding:15px;
  border-radius:10px;
}
.correct{color:#22c55e;}
.wrong{color:#ef4444;}
</style>
</head>

<body>

<h2>ØªØ­ÙˆÙŠÙ„ PDF Ø¥Ù„Ù‰ Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒÙŠ</h2>

<input type="file" id="pdfFile" accept="application/pdf">
<br>
<button class="primary" id="extractBtn">ğŸ“„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ</button>
<button class="secondary" id="generateBtn">âœ¨ ØªÙˆÙ„ÙŠØ¯ Ø§Ø®ØªØ¨Ø§Ø±</button>
<button class="secondary" id="regenBtn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯</button>
<button class="success" id="gradeBtn">âœ… ØªØµØ­ÙŠØ­</button>

<textarea id="outputText" placeholder="Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§..."></textarea>

<div id="quizContainer" class="quiz-box"></div>
<div id="result"></div>

<script>

pdfjsLib.GlobalWorkerOptions.workerSrc =
  "./vendor/pdfjs/pdf.worker.min.js";

const pdfInput = document.getElementById("pdfFile");
const extractBtn = document.getElementById("extractBtn");
const generateBtn = document.getElementById("generateBtn");
const regenBtn = document.getElementById("regenBtn");
const gradeBtn = document.getElementById("gradeBtn");
const outputText = document.getElementById("outputText");
const quizContainer = document.getElementById("quizContainer");
const resultDiv = document.getElementById("result");

let extractedText = "";
let questions = [];

function cleanText(t){
  return (t||"").replace(/\s+/g," ").trim();
}

function splitSentences(t){
  return cleanText(t)
    .split(/(?<=[\.\!\?ØŸØ›:])\s+/)
    .filter(s=>s.length > 50);
}

function extractTerms(text){
  return [...new Set(
    text.split(/\s+/)
      .filter(w => w.length >= 7 || /[A-Za-z]/.test(w))
  )].slice(0,50);
}

function shuffle(arr){
  return arr.sort(()=>Math.random()-0.5);
}

extractBtn.onclick = async () => {
  const file = pdfInput.files[0];
  if (!file) return alert("Ø§Ø®ØªØ± Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹");

  const reader = new FileReader();
  reader.onload = async function() {
    const typedarray = new Uint8Array(this.result);
    const pdf = await pdfjsLib.getDocument({data: typedarray}).promise;

    let fullText = "";
    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      const strings = content.items.map(item => item.str);
      fullText += strings.join(" ") + "\n";
    }

    extractedText = fullText;
    outputText.value = fullText;
  };
  reader.readAsArrayBuffer(file);
};

function generateQuiz(){
  if (!extractedText) {
    extractedText = outputText.value;
  }
  if (!extractedText) return alert("Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù†Øµ Ø£ÙˆÙ„Ø§Ù‹");

  quizContainer.innerHTML = "";
  resultDiv.innerHTML = "";
  questions = [];

  const sentences = splitSentences(extractedText);
  const terms = extractTerms(extractedText);

  const picked = shuffle(sentences).slice(0,5);

  // ØµØ­/Ø®Ø·Ø£
  picked.forEach((s, i)=>{
    questions.push({
      type:"TF",
      question:s,
      answer:"ØµØ­"
    });
  });

  // Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯
  for(let i=0;i<5;i++){
    const term = terms[i];
    if(!term) continue;

    const sentence = sentences.find(s=>s.includes(term));
    if(!sentence) continue;

    const stem = sentence.replace(term,"_____");
    const options = shuffle([term, ...shuffle(terms).slice(1,4)]);

    questions.push({
      type:"MCQ",
      question:`Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©:\n${stem}`,
      options:options,
      answer:term
    });
  }

  renderQuiz();
}

function renderQuiz(){
  quizContainer.innerHTML = "";
  questions.forEach((q,index)=>{
    const div = document.createElement("div");
    div.innerHTML = `<p>${index+1}) ${q.question}</p>`;

    if(q.type==="TF"){
      div.innerHTML += `
        <label><input type="radio" name="q${index}" value="ØµØ­"> ØµØ­</label>
        <label><input type="radio" name="q${index}" value="Ø®Ø·Ø£"> Ø®Ø·Ø£</label>
      `;
    }

    if(q.type==="MCQ"){
      q.options.forEach(opt=>{
        div.innerHTML += `
          <label><input type="radio" name="q${index}" value="${opt}"> ${opt}</label>
        `;
      });
    }

    div.innerHTML += "<hr>";
    quizContainer.appendChild(div);
  });
}

gradeBtn.onclick = ()=>{
  let score = 0;

  questions.forEach((q,index)=>{
    const selected = document.querySelector(`input[name="q${index}"]:checked`);
    if(selected && selected.value === q.answer){
      score++;
    }
  });

  const finalScore = Math.round((score/questions.length)*100);
  resultDiv.innerHTML = `<h3>Ø¹Ù„Ø§Ù…ØªÙƒ: ${finalScore} / 100</h3>`;
};

generateBtn.onclick = generateQuiz;
regenBtn.onclick = generateQuiz;

</script>

<br>
<div style="margin-top:30px;text-align:center;opacity:0.6">
Dev : Ahmad Shami
</div>

</body>
</html>
