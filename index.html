<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF â†’ Text (Local PDF.js) | Dev : Ahmad Shami</title>

  <!-- âœ… Local PDF.js (NO CDN) -->
  <script src="./vendor/pdfjs/pdf.min.js"></script>

  <style>
    :root{
      --bg:#0b1020; --card:rgba(255,255,255,.06); --card2:rgba(255,255,255,.09);
      --txt:#eaf0ff; --muted:rgba(234,240,255,.7);
      --good:#28d17c; --bad:#ff4d6d; --btn:#2d6cdf; --btn2:#1b2446;
      --bd:rgba(255,255,255,.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: radial-gradient(1200px 800px at 20% 10%, #1a2a6c33, transparent),
                  radial-gradient(900px 700px at 80% 20%, #b21f1f26, transparent),
                  radial-gradient(900px 700px at 50% 90%, #fdbb2d14, transparent),
                  var(--bg);
      color:var(--txt);
      padding:18px;
    }
    .wrap{max-width:980px;margin:0 auto}
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    h1{font-size:18px;margin:0}
    .pill{padding:7px 10px;border:1px solid var(--bd);border-radius:999px;background:rgba(0,0,0,.15);color:var(--muted);font-size:12px}
    .card{
      margin-top:14px;
      border:1px solid var(--bd);
      background:linear-gradient(180deg,var(--card),rgba(0,0,0,.15));
      border-radius:16px;
      padding:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .row > *{flex:1}
    .btn{
      border:1px solid var(--bd);
      background:linear-gradient(180deg,rgba(45,108,223,.95),rgba(30,78,170,.85));
      color:white;
      padding:12px 14px;border-radius:14px;
      font-weight:700;
      cursor:pointer;
      min-width:180px;
    }
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn.secondary{background:linear-gradient(180deg,rgba(27,36,70,.95),rgba(20,26,50,.9))}
    input[type="file"]{
      width:100%;
      padding:12px 14px;
      border-radius:14px;
      border:1px dashed var(--bd);
      background:rgba(0,0,0,.18);
      color:var(--muted);
    }
    .status{
      margin-top:10px;
      padding:10px 12px;border-radius:12px;border:1px solid var(--bd);
      background:rgba(0,0,0,.18);
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
    }
    .status.good{border-color:rgba(40,209,124,.5); color:#bff8dc}
    .status.bad{border-color:rgba(255,77,109,.5); color:#ffd1db}
    textarea{
      width:100%;
      min-height:220px;
      resize:vertical;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid var(--bd);
      background:rgba(0,0,0,.18);
      color:var(--txt);
      outline:none;
      line-height:1.7;
      font-size:14px;
    }
    .small{color:var(--muted);font-size:12px;margin-top:8px}
    .footer{margin-top:14px;color:var(--muted);text-align:center;font-size:12px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, monospace; background:rgba(255,255,255,.08); padding:2px 6px; border-radius:8px; border:1px solid var(--bd)}
  </style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <h1>ØªØ­ÙˆÙŠÙ„ PDF Ø¥Ù„Ù‰ Ù†Øµ (Ø¨Ø¯ÙˆÙ† CDN) â€” PDF.js Ù…Ø­Ù„ÙŠ</h1>
    <div class="pill" id="libPill">Ø¬Ø§Ø±Ù ÙØ­Øµ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øªâ€¦</div>
  </div>

  <div class="card">
    <div class="row">
      <div>
        <label class="small">1) Ø§Ø®ØªØ± Ù…Ù„Ù PDF</label>
        <input id="pdfFile" type="file" accept="application/pdf" />
        <div class="small">Ù…Ù‡Ù…: Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ø¹Ù†Ø¯Ùƒ Ø¨Ø§Ù„Ø±ÙŠØ¨Ùˆ <span class="kbd">vendor/pdfjs/pdf.min.js</span> Ùˆ <span class="kbd">vendor/pdfjs/pdf.worker.min.js</span></div>
      </div>

      <div style="min-width:220px">
        <label class="small">&nbsp;</label>
        <button class="btn" id="extractBtn" disabled>ğŸ“„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ (PDF)</button>
        <button class="btn secondary" id="clearBtn">ğŸ§¹ Ù…Ø³Ø­</button>
      </div>
    </div>

    <div class="status" id="status">Ø§Ø®ØªØ± Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹.</div>

    <div style="margin-top:12px">
      <label class="small">Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬</label>
      <textarea id="out" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù†Øµ Ù‡Ù†Ø§â€¦"></textarea>
      <div class="small">Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù„ÙÙƒ Scan (ØµÙˆØ± Ø¯Ø§Ø®Ù„ PDF) Ù„Ù† ÙŠØ¸Ù‡Ø± Ù†Øµ Ù‡Ù†Ø§ â€” Ø¹Ù†Ø¯Ù‡Ø§ Ù†Ø­ØªØ§Ø¬ OCR (Ù†Ø¶ÙŠÙÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ø­Ù„ÙŠ).</div>
    </div>

    <div class="footer">Dev : Ahmad Shami</div>
  </div>
</div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const pdfFile   = $("pdfFile");
  const extractBtn= $("extractBtn");
  const clearBtn  = $("clearBtn");
  const statusEl  = $("status");
  const outEl     = $("out");
  const libPill   = $("libPill");

  let PDF_DOC = null;

  function setStatus(msg, ok=null){
    statusEl.textContent = msg;
    statusEl.classList.remove("good","bad");
    if(ok === true) statusEl.classList.add("good");
    if(ok === false) statusEl.classList.add("bad");
  }

  function setLibPill(text, ok){
    libPill.textContent = text;
    libPill.style.borderColor = ok ? "rgba(40,209,124,.6)" : "rgba(255,77,109,.6)";
    libPill.style.color = ok ? "#bff8dc" : "#ffd1db";
  }

  // âœ… Check pdfjsLib exists (loaded locally)
  if(typeof window.pdfjsLib === "undefined"){
    setLibPill("PDF.js ØºÙŠØ± Ù…Ø­Ù…Ù‘Ù„ âŒ", false);
    setStatus(
      "ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ PDF.js Ù…Ø­Ù„ÙŠØ§Ù‹. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„Ø¶Ø¨Ø·:\n" +
      "vendor/pdfjs/pdf.min.js\nvendor/pdfjs/pdf.worker.min.js",
      false
    );
    return;
  } else {
    setLibPill("PDF.js Ù…Ø­Ù„ÙŠ Ø¬Ø§Ù‡Ø² âœ…", true);
  }

  // âœ… Set worker locally (NO CDN)
  try{
    pdfjsLib.GlobalWorkerOptions.workerSrc = "./vendor/pdfjs/pdf.worker.min.js";
  }catch(e){
    console.error(e);
    setStatus("ÙØ´Ù„ Ø¥Ø¹Ø¯Ø§Ø¯ PDF worker Ù…Ø­Ù„ÙŠØ§Ù‹. ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø§Ø± pdf.worker.min.js", false);
    return;
  }

  async function loadPDF(file){
    const ab = await file.arrayBuffer();
    const task = pdfjsLib.getDocument({ data: ab });
    PDF_DOC = await task.promise;
    return PDF_DOC;
  }

  async function extractTextFromPDF(){
    if(!PDF_DOC) throw new Error("Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ PDF Ø¨Ø¹Ø¯.");
    const total = PDF_DOC.numPages;
    let all = "";
    for(let p=1; p<=total; p++){
      setStatus(`Ø¬Ø§Ø±Ù Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµâ€¦ ØµÙØ­Ø© ${p}/${total}`, true);
      const page = await PDF_DOC.getPage(p);
      const content = await page.getTextContent();
      const strings = content.items.map(it => it.str).filter(Boolean);
      all += strings.join(" ") + "\n\n";
    }
    return all.trim();
  }

  pdfFile.addEventListener("change", async () => {
    const f = pdfFile.files && pdfFile.files[0];
    PDF_DOC = null;
    outEl.value = "";
    extractBtn.disabled = true;

    if(!f){
      setStatus("Ø§Ø®ØªØ± Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹.", null);
      return;
    }

    setStatus("Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ PDFâ€¦", true);
    try{
      await loadPDF(f);
      extractBtn.disabled = false;
      setStatus(`ØªÙ… ØªØ­Ù…ÙŠÙ„ PDF âœ… Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª: ${PDF_DOC.numPages}. Ø§Ø¶ØºØ· â€œØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµâ€.`, true);
    }catch(e){
      console.error(e);
      setStatus("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ PDF. Ø¬Ø±Ù‘Ø¨ Ù…Ù„Ù Ø£ØµØºØ± Ø£Ùˆ PDF ØºÙŠØ± Ù…Ø­Ù…ÙŠ Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±.", false);
    }
  });

  extractBtn.addEventListener("click", async () => {
    if(!PDF_DOC){
      setStatus("Ø§Ø®ØªÙØ± Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹.", false);
      return;
    }
    extractBtn.disabled = true;
    try{
      const text = await extractTextFromPDF();
      outEl.value = text || "";
      if(!text){
        setStatus("ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù„ÙƒÙ† Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Øµ. ØºØ§Ù„Ø¨Ø§Ù‹ Ù‡Ø°Ø§ PDF Scan ÙˆÙŠØ­ØªØ§Ø¬ OCR.", false);
      }else{
        setStatus("ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ âœ…", true);
      }
    }catch(e){
      console.error(e);
      setStatus("ØµØ§Ø± Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ. Ø§ÙØªØ­ Console Ù„Ù„ØªÙØ§ØµÙŠÙ„.", false);
    }finally{
      extractBtn.disabled = false;
    }
  });

  clearBtn.addEventListener("click", () => {
    outEl.value = "";
    pdfFile.value = "";
    PDF_DOC = null;
    extractBtn.disabled = true;
    setStatus("ØªÙ… Ø§Ù„Ù…Ø³Ø­. Ø§Ø®ØªØ± Ù…Ù„Ù PDF Ø¬Ø¯ÙŠØ¯.", null);
  });

})();
</script>
</body>
</html>
